@model IEnumerable<HShop2024.ViewModels.CartItem>
@{
    ViewData["Title"] = "Giỏ hàng";
    var discount = TempData["CouponDiscount"] != null ? (double)TempData["CouponDiscount"] : 0;
    var couponMessage = TempData["CouponMessage"] as string;
}

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5 bg-primary text-white">
    <h1 class="text-center display-4">Cart</h1>
    <ol class="breadcrumb justify-content-center mb-0">
        <li class="breadcrumb-item"><a href="#" class="text-white">Home</a></li>
        <li class="breadcrumb-item"><a href="#" class="text-white">Pages</a></li>
        <li class="breadcrumb-item active">Cart</li>
    </ol>
</div>
<!-- Single Page Header End -->
@if (couponMessage != null)
{
    <div class="alert alert-info mt-4" role="alert">
        @couponMessage
    </div>
}

<!-- Cart Page Start -->
<div class="container py-5">
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead class="thead-light">
                <tr>
                    <th scope="col">Products</th>
                    <th scope="col">Name</th>
                    <th scope="col">Price</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Total</th>
                    <th scope="col">Handle</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <img src="~/Hinh/HangHoa/@item.Hinh" class="img-fluid rounded" style="width: 80px; height: 80px;" alt="@item.TenHH">
                        </td>
                        <td>
                            <a asp-action="Detail" asp-controller="HangHoa" asp-route-id="@item.MaHh" class="text-decoration-none">
                                @item.TenHH
                            </a>
                        </td>
                        <td>
                            $ @item.DonGia
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <form method="post" action="@Url.Action("UpdateCartQuantity", "Cart")" class="me-2">
                                    <input type="hidden" name="id" value="@item.MaHh" />
                                    <input type="hidden" name="quantity" value="@item.SoLuong" />
                                    <button type="submit" class="btn btn-outline-primary btn-sm" name="action" value="increase">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </form>
                                <input type="text" class="form-control form-control-sm text-center" value="@item.SoLuong" readonly />
                                <form method="post" action="@Url.Action("UpdateCartQuantity", "Cart")" class="ms-2">
                                    <input type="hidden" name="id" value="@item.MaHh" />
                                    <input type="hidden" name="quantity" value="@item.SoLuong" />
                                    <button type="submit" class="btn btn-outline-primary btn-sm" name="action" value="decrease">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                        <td>
                            $ @item.ThanhTien
                        </td>
                        <td>
                            <a href="javascript:void(0);" onclick="confirmDelete('@item.MaHh')" class="btn btn-outline-danger btn-sm">
                                <i class="fa fa-times"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Coupon Code Section -->
    <div class="mt-5 d-flex">
        <form method="post" action="@Url.Action("ApplyCoupon", "Cart")" class="d-flex">
            <input type="text" name="couponCode" class="form-control me-2" placeholder="Coupon Code">
            <button type="submit" class="btn btn-outline-primary">Apply Coupon</button>
        </form>
    </div>

    <!-- Cart Summary Section -->
    <div class="mt-5 bg-light rounded p-4">
        <h4 class="mb-4">Cart Summary</h4>
        <div class="d-flex justify-content-between mb-3">
            <h5 class="mb-0">Subtotal:</h5>
            <p class="mb-0">$<span id="subtotal">@Model.Sum(p => p.ThanhTien)</span></p>
        </div>
        <div class="d-flex justify-content-between mb-3">
            <h5 class="mb-0">Discount:</h5>
            <p class="mb-0">-$<span id="discount">@Model.Sum(p => p.ThanhTien) * discount</span></p>
        </div>
        <div class="d-flex justify-content-between mb-3">
            <h5 class="mb-0">Shipping:</h5>
            <p class="mb-0">Flat rate: FREE</p>
        </div>
        <div class="d-flex justify-content-between border-top pt-3">
            <h5 class="mb-0">Total:</h5>
            <p class="mb-0">$<span id="total">@Model.Sum(p => p.ThanhTien) * (1 - discount)</span></p>
        </div>
        <a class="btn btn-primary mt-4" asp-action="Checkout" asp-controller="Cart">Xác Nhận</a>
    </div>
</div>
<!-- Cart Page End -->
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function confirmDelete(productId) {
            var result = confirm("Bạn đã chắc chưa?");
            if (result) {
                window.location.href = '/Cart/RemoveCart/' + productId;
            }
        }
    </script>
}
